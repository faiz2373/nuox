{% extends "admin/layout/user_base.html" %}
{% load static %}
{% block body_block %}
{% load my_filters %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<main class="content-area">
    <div class="container-fluid p-0">
        <!-- top search bar -->
        <div class="top-seach-bar mb-0">
            <!-- top bar form  -->
            <form class="search-form mt-2">

                <div class="add-product-filter user_table_product_filter">
                    <div class="row align-items-center">
                        <div class="col-xl-2 col-lg-2">
                            <h3 class="top-bar-heading">Equipments</h3>
                        </div>
                        <div class="col-xl-10 col-lg-10">
                            <div class="row_2 align-items-top justify-content-end">
                                <div class="top-search-wrapper">
                                    <div class="form-group">
                                        <input type="text" name="search" value="{{ request.GET.search }}" class="form-control"
                                            placeholder="Search Name" id="search">
                                    </div>
                                    <div ><span id="error_msg"></span></div>
                                </div>

                                <div class="date-selector-wrapper">
                                    <div class="form-group">
                                      <input type="text" name="stDate" value="{{ request.GET.stDate }}" class="form-control" id="stDate" placeholder="From Date">
                                    </div>
                                </div> 
                                
                                <div class="date-selector-wrapper">
                                    <div class="form-group">
                                      <input type="text" name="endDate" value="{{ request.GET.endDate }}" class="form-control" id="endDate" placeholder="To Date">
                                    </div>
                                </div> 

                                <div class=" top-action-wrapper d-flex align-items-top">
                                    <button class="btn btn-detail" id="sbmit">Filter</button>
                                    <a href="{% url 'appdashboard:equipments' %}" class="reset">Reset</a>
                                    <a href="{% url 'appdashboard:equipments-add'%}">
                                        <button type="button" class="btn btn-detail">Create</button>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="col-xl-3 col-lg-3 ">
                            <div class="form-group">
                                <input type="search" name="search" value="{{ request.GET.search }}" class="form-control"
                                    placeholder="Search Name" id="search">
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-2 d-flex align-items-center">
                            <button class="btn btn-detail me-2" id="sbmit">Submit</button>
                            <a href="{% url 'appdashboard:equipments-add'%}">
                                <button type="button" class="btn btn-detail">Create</button>
                            </a>
                            <a href="{% url 'appdashboard:equipments' %}" class="reset">Reset</a>
                        </div> -->
                       
                    </div>
            </form>
            
        </div>

        <!-- top bar form  end-->
    </div>
    <!-- top search bar end-->

    <!-- right side content box  -->
    <div class="main-box pd-0">

        <div class="add-product-sec">
            <div class="product-area-list">
            </div>
            <div class="product-area-list list-head" >
                <div class="product-box-heading gymIndexData bx-sd mb-1">
                    <div class="row">
            
                        <div class="col-xl-1 col-lg-1">
                            <div class="product-content">
                                SL
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-2">
                            <div class="product-content">
                                Name
                            </div>
                        </div>
                        <div class="col-xl-1 col-lg-1">
                            <div class="product-content">
                                Image
                            </div>
                        </div>
                        <div class="col-xl-1 col-lg-1 text-center">
                            <div class="product-content">
                                QR Code
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-1 text-center">
                            <div class="product-content">
                                Introduction Video
                            </div>
                        </div>
                        <div class="col-xl-1 col-lg-1 text-center">
                            <div class="product-content">
                                Created Date
                            </div>
                        </div>

                        <div class="col-xl-3 col-lg-3">
                            <div class="product-content">
                                Action
                            </div>
                        </div>
                    </div>
                </div>
                {% for rec in equipment %}
                <!-- prodcut box  -->
                <div class="product-box gymIndexData bx-sd mb-1">
                    <div class="row">
                        <!-- <div class="col-xl-1 col-lg-1">
                                    <div class="pro2-img table_pro_pic">
                                        <img src="{% if rec.image %} {{ rec.image.url }} {% else %} {% static 'admin/icons/user.png' %} {% endif %}"
                                             width="64" height="64">
                                    </div>
                                </div> -->

                      
                        <div class="col-xl-1 col-lg-1">
                            <div class="product-content">
                                <h3>{{ start_index|add:forloop.counter0 }}</h3>
                            </div>
                        </div>

                        <div class="col-xl-2 col-lg-2">
                            <div class="product-content">
                                <h3>{% if rec.equipment_name %}{{rec.equipment_name}}{% else %}{{rec.equipment_name_ar}}{% endif %}</h3>
                            </div>
                        </div>


                        <div class="col-xl-1 col-lg-1">
                            <div class="product-content">
                                <a data-fancybox data-small-btn="true" class="popup-image person-image" href="{{ rec.equipment_image.url }}" >
                                    <img src="{{ rec.equipment_image.url }}"  ></a>
                            </div>
                        </div>


                        <div class="col-xl-1 col-lg-1 text-center">
                            <div class="product-content" style="height: 50px;">
                                {% if rec.qr_code_id|generate_qr_code != "None" %}
                                <a class="qr-code-link" data-fancybox data-small-btn="true" href="data:image/png;base64,{{ rec.qr_code_id|generate_qr_code }}">
                                    <img src="data:image/png;base64,{{ rec.qr_code_id|generate_qr_code }}" width="64" height="64"/>
                                </a>
                                {% else %}
                                    <h3>None</h3>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-xl-2 col-lg-1 text-center">
                            <div class="product-content card-deck ">
                                <a  data-fancybox data-small-btn="true" href="{{ rec.introduction_video.url }}">
                                    {% if rec.introduction_video.url %}
                                    <div id="show-up-vid" class="video_up_status_div"
                                    style="margin-top: 10px">
                                        <a class="play-btn-link" data-fancybox data-small-btn="true" class="popup-youtube"
                                            href="{{ rec.introduction_video.url }}" >
                                            <img src="{% static './images/play-button.png' %}">
                                        </a>
                                    </div>
                                    {% endif %}
                                </a>
                            </div>
                        </div>
                        
                        <div class="col-xl-1 col-lg-1" style="text-align: center;">
                            <div class="product-content">
                                <h3>{% if rec.created_at %}{{ rec.created_at| to_default_timezone }}{% else %}---{% endif %}</h3>
                            </div>
                        </div>

                        <div class="col-xl-3 col-lg-3 ">
                                <a href="{% url 'appdashboard:equipments-edit' id=rec.pk %}">
                                    <button class="btn btn-detail " style="margin-bottom: 0;">Edit</button>
                                </a>
                                <button type="button" onclick="statusChange('{{rec.id}}','delete')" class="btn btn-detail disb_btn" id="statusBtn_{{rec.id}}" style="margin-bottom: 0;" >
                                    Delete
                                </button>
                        </div>
                    </div>
                </div>
                {% empty %}
                        <div class="col-xl-12 col-lg-3 text-center mt-3">
                            <h5>No Records</h5>
                        </div>
                {% endfor %}

                {% if equipment %}
                <div class="row">
                    <div class="col-sm-6 mt-3 pagination-count">Showing <span>{{ start_index }}</span> to <span>{{ end_index }}</span> of <span>{{ count }}</span> entries</div>

                    <div class="col-sm-6 mt-3">
                        <nav aria-label="Page navigation ">
                            <ul class="pagination justify-content-end">
                                {% for i in page_range %}
                                <li id="pagination-count{{i}}"
                                    class="page-item ">
                                    <a
                                        class="page-link {% if i  == page %} activedata {% endif %}" href="?page={{ i }}{{ params }}">{{i}}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </nav>
                    </div>
                </div>
                {% endif %}

            </div>
            <!-- prodcut box  end-->
        </div>
    </div>
    </div>
    {% csrf_token %}
    <!-- right side content box  -->
    </div>
</main>
{% endblock body_block %}

{% block page_script %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    flatpickr("#stDate", {
      allowInput: true,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });
    flatpickr("#endDate", {
      allowInput: true,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });endDate
    
    Fancybox.bind('[data-fancybox]', {
    Toolbar: {  
        display: [
        "download",
        "close",
        ],
    },
    });
    $("#sbmit").click(function()
        {
            search = $('#search').val()
            stDate = $('#stDate').val()
            endDate = $('#endDate').val()
            date_flag = 0

            if(stDate != '' && endDate != ''){
                date_flag=1
            }
            else{
                if(stDate!='' && endDate ==''){
                    $('#error_msg').text('You cannot leave to date empty')
                    date_flag = 0
                    return false
                }
                else if(stDate =='' && endDate !=''){
                    $('#error_msg').text('You cannot leave from date empty')
                    date_flag = 0
                    return false
                }
                else  if(stDate =='' && endDate ==''){
                    date_flag = 0
                }
            }
           
            if (search == '' && date_flag == 0)
            {
                $('#error_msg').text('Choose any filtering option')
                return false;
            }
        })  

        $('.popup-youtube').fancybox({
           width  : 500,
           height : 500,
           autoSize : false
           });
    
           function statusChange(id,msg)
            {
                Swal.fire({
                    title: 'Are you sure?',  
                    text: 'Do you want to '+msg+' this equipment!',  
                    type: 'warning',
                    confirmButtonText: 'Yes',
                    confirmButtonColor: 'LightSeaGreen',
                    cancelButtonColor: 'Crimson',
                    cancelButtonText: 'No',
                    showCancelButton: true,
                    // reverseButtons: true
                })
                .then(function(e){
                    if (e.value === true) {
                    data = {}
                    data['userid'] = id
                    $.ajax({
                    type:'PUT',
                    url: '/sec-access/equipment-enabledisable/',
                    data: data,
                    success: function(response){
                        Swal.fire({
                            type: 'success',
                            icon: 'success',
                            showConfirmButton: false,
                            title: response.msg,
                            timer: 2000
                        });
                        setTimeout(function(){
                            window.location.reload(1);
                            }, 1000);
                        // var btnid = '#statusBtn_'+id;
                        // if(msg == 'enable'){
                        //     $(btnid).text('DISABLE');
                        //     $(btnid).attr('onclick', 'statusChange('+id+',"disable")');
                        // }
                        // else{
                        //     $(btnid).text('ENABLE');
                        //     $(btnid).attr('onclick', 'statusChange('+id+',"enable")');
                        // }
                    }
                })
                
            }
        })
        }
</script>
    {% if messages %}
            {% for message in messages %}
            {% if message.tags == "success" %}
                <script> 
                Swal.fire({
                type: 'success',
                icon: 'success',
                showConfirmButton: false,
                title:'{{message}}'
                });
                setTimeout(function(){
                window.location.reload(1);
                }, 1000);
                </script>
            {% endif %}
            {% if message.tags == "info" %}
                <script> 
                Swal.fire({
                type: 'error',
                icon: 'info',
                showConfirmButton: false,
                title:'{{message}}'
                });
                setTimeout(function(){
                window.location.reload(1);
                }, 1000);
                </script>
            {% endif %}
            {% endfor %}
        {% endif %}
<style>
    .row {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
    }
    .statusBtn{
        display: flex;
        justify-content: space-around;
    }
    #error_msg{
            color:red;
        }
    
</style>
{% endblock %}