{% extends "admin/layout/user_base.html" %}
{% load static %}
{% block body_block %}
{% load my_filters %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <main class="content-area">
        <div class="container-fluid p-0">
            <!-- top search bar -->
            <div class="top-seach-bar mb-0">
                <!-- top bar form  -->
                <form class="search-form mt-2">
                    <div class="add-product-filter user_table_product_filter">
                        <div class="row align-items-center">
                            <div class="col-xl-2 col-lg-2">
                                <h3 class="top-bar-heading">Activity Log</h3>
                            </div>
                            <div class="col-xl-10 col-lg-10">
                                <div class=" row_2 align-items-top justify-content-end ">
                                    <div class="top-search-wrapper ">
                                        <div class="form-group">
                                            <input type="text" name="search" value="{{ request.GET.search }}" class="form-control" placeholder="Search" id="name">
                                        </div>
                                        <div><span id="error_msg"></span></div>

                                    </div>
                                    <div class="table-filter">
                                        <div class="filter-box">
                                            <p>More Filters</p>
                                                <img src="{% static 'admin/img/filter_icon.svg' %}"/>   
                                        </div>
                                        <div class="filter-wrapper ">
                                            <div class="filter-title">
                                                <!-- <h5>Sort By</h5> -->
                                                <div><span id="error_msg2"></span></div>

                                                <span class="close-filter">Ã—</span>  
                                            </div> 
                                            <ul class="filter-list"> 
                                                <li class="filter-item">  
                                                    <div class="top-select-wrapper ">
                                                        <div class="form-group">
                                                            <select class="form-control filter-select" name="action" id="action">
                                                                <option value="">Select Action type</option>
                                                                <option value="Create" {% if request.GET.action == 'Create' %}selected{% endif %}>Create</option>   
                                                                <option value="Update" {% if request.GET.action == 'Update' %}selected{% endif %}>Update</option>   
                                                                <option value="Delete" {% if request.GET.action == 'Delete' %}selected{% endif %}>Delete</option>   
                                                                <option value="Login" {% if request.GET.action == 'Login' %}selected{% endif %}>Login</option>   
                                                                <option value="Logout" {% if request.GET.action == 'Logout' %}selected{% endif %}>Logout</option>   
                                                                <option value="Login Failed" {% if request.GET.action == 'Login Failed' %}selected{% endif %}>Login Failed</option>    
                                                                <!-- {% for action in action_type %}
                                                                    {% if request.GET.action == action %}
                                                                        <option value={{action}} selected> {{action}} </option> 
                                                                    {% else %} 
                                                                        <option value={{action}} > {{action}} </option>  
                                                                    {% endif %}
                
                                                                {% endfor %}    -->
                                                            </select>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="filter-item">  
                                                    <div class="top-select-wrapper">
                                                        <div class="form-group">
                                                            <select class="form-control filter-select" name="status" id="status">
                                                                <option value="">Select Status</option>
                                                                <option value="Success" {% if request.GET.status == 'Success' %}selected{% endif %}>Success</option>    
                                                                <option value="Failed" {% if request.GET.status == 'Failed' %}selected{% endif %}>Failed</option>    
                                                            </select>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="filter-item">  
                                                    <div class="top-select-wrapper">
                                                        <div class="form-group">
                                                            <select class="form-control filter-select" name="type" id="type">
                                                                <option value="">Select Application Type</option>
                                                                <option value="Web" {% if request.GET.type == 'Web' %}selected{% endif %}>Web</option>    
                                                                <option value="App" {% if request.GET.type == 'App' %}selected{% endif %}>App</option>    
                                                            </select>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="filter-item two-item-filter"> 
                                                    <div class="date-selector-wrapper">
                                                        <div class="form-group">
                                                          <input type="text" name="stDate" value="{{ request.GET.stDate }}" class="form-control" id="stDate" placeholder="From Date">
                                                        </div>
                                                        
                
                                                    </div> 
                                                    <div class="date-selector-wrapper">
                                                        <div class="form-group">
                                                          <input type="text" name="endDate" value="{{ request.GET.endDate }}" class="form-control" id="endDate" placeholder="To Date">
                                                        </div>
                                                    </div> 
                                                    <div class="flex-grow-1"><span id="error_msg"></span></div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="top-action-wrapper d-flex align-items-top ">
                                        <button class="btn btn-detail " id="sbmit">Filter</button>
                                        <a href="{% url 'appdashboard:activity-log' %}" class="reset">Reset</a>
                                        <!-- <a href="{% url 'appdashboard:gym_add'%}">
                                            <button type="button" class="btn btn-detail">Create</button>
                                        </a> -->
                                    </div>
                                </div>
                                
                            </div> 
                        </div>
                        
                </form>
                <!-- <div><span id="error_msg"></span></div> -->

            </div>

            <!-- top bar form  end-->
        </div>
        <!-- top search bar end-->

        <!-- right side content box  -->
        <div class="main-box pd-0">

            <div class="add-product-sec">
                <div class="product-area-list">
                </div>
                <div class="product-area-list list-head">
                    <div class="product-box-heading gymIndexData bx-sd mb-1">
                        <div class="row">
                            <div class="col-xl-1 col-lg-1">
                                <div class="product-content">
                                    SL
                                </div>
                            </div>
                            <div class="col-xl-4 col-lg-4">
                                <div class="product-content">
                                    Activity 
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2">
                                <div class="product-content">
                                    Activity Type 
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2">
                                <div class="product-content">
                                    Status 
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2">
                              <div class="product-content">
                                    Date
                              </div>
                          </div>
                            <div class="col-xl-1 col-lg-1">
                                <div class="product-content">
                                    Time 
                                </div>
                            </div>
                        
                        </div>
                    </div>
                    {% for rec in records %}
                        <!-- prodcut box  -->
                        <div class="product-box user-level gymIndexData bx-sd mb-1">
                            <div class="row">
                                <div class="col-xl-1 col-lg-1">
                                    <div class="product-content">
                                        <h3>{{ start_index|add:forloop.counter0 }}</h3>
                                    </div>
                                </div>
                                <div class="col-xl-4 col-lg-4">
                                    <div class="product-content">
                                        <h3 style="word-break: break-all;">{% if rec.remarks %}{{ rec.remarks }}{% elif rec.error_msg %}{{rec.error_msg}}{% else %}None{% endif %}</h3>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-2">
                                    <div class="product-content">
                                        <h3>{{ rec.action_type }}</h3>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-2">
                                    <div class="product-content">
                                        <h3 style="word-break: break-all;">{{ rec.status }}</h3>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-2">
                                    <div class="product-content">
                                        <h3>{{ rec.action_time | to_default_date }}</h3>
                                    </div>
                                </div>                        
                                <div class="col-xl-1 col-lg-1">
                                    <div class="product-content">
                                        <h3>{{ rec.action_time | to_default_time }}</h3>
                                    </div>
                                </div>   
                             
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-xl-12 col-lg-3 text-center mt-3">
                            <h5>No Records</h5>
                        </div>
                    {% endfor %}

                    {% if records %}
                    <div class="row">
                        <div class="col-sm-6 mt-3 pagination-count">Showing <span>{{ start_index }}</span> to <span>{{ end_index }}</span> of <span>{{ count }}</span> entries</div>

                        <div class="col-sm-6 mt-3">
                            <nav aria-label="Page navigation ">
                                <ul class="pagination justify-content-end">
                                    {% for i in page_range %}
                                    <li id="pagination-count{{i}}"
                                        class="page-item"><a
                                            class="{% if i  == page %} activedata {% endif %} page-link" href="?page={{ i }}{{ params }}">{{i}}</a></li>
                                    {% endfor %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                    {% endif %}

                </div>
                <!-- prodcut box  end-->
            </div>
        </div>
        </div>
        <!-- right side content box  -->
        </div>
    </main>
{% endblock body_block %}

{% block page_script %}
<script src="{% static 'admin/assets/js/jquery.sumoselect.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    flatpickr("#stDate", {
      allowInput: true,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });
    flatpickr("#endDate", {
      allowInput: true,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });

    $("#sbmit").click(function()
    {
        name = $('#name').val()
        type = $('#type').val()
        action = $('#action').val()
        status = $('#status').val()
        stDate = $('#stDate').val()
        endDate = $('#endDate').val()
        date_flag = 0

        if(stDate != '' && endDate != ''){
            date_flag=1
        }
        else{
            if(stDate!='' && endDate ==''){
                $('#error_msg').text('You cannot leave to date empty')
                date_flag = 0
                return false
            }
            else if(stDate =='' && endDate !=''){
                $('#error_msg').text('You cannot leave from date empty')
                date_flag = 0
                return false
            }
            else  if(stDate =='' && endDate ==''){
                date_flag = 0
            }
        }
        
        if (date_flag == 0 && action=='' && status =='' && name == '' && type == '')
        {
            $('#error_msg').text('Choose any filtering option')
            return false;
        }
    }) 
    
        function btnok(id,msg)
            {
                Swal.fire({
                    title: 'Are you  sure you want to '+msg+' it ?',  
                    type: 'warning',
                    confirmButtonText: 'Yes',
                    confirmButtonColor: 'LightSeaGreen',
                    cancelButtonColor: 'Crimson',
                    cancelButtonText: 'No',
                    showCancelButton: true,
                    // reverseButtons: true
                })
                .then(function(e){
                    if (e.value === true) {
                    data = {}
                    data['userid'] = id
                    $.ajax({
                    type:'PUT',
                    url: '/sec-access/frame-enabledisable/',
                    data: data,
                    success: function(response){
                        Swal.fire({
                            type: 'success',
                            icon: 'success',
                            showConfirmButton: false,
                            title:response.msg
                            });
                    }
                })
                setTimeout(function(){
                    window.location.reload(1);
                    }, 1000);
            }
        })
        }

    </script>
        <style>
            #error_msg{
            color:red;
            }
           
            .alert-container{
                position: absolute;
                top: 45%;
                left: 20%;
                right: auto;
                margin: auto;
                width: 75%;
                height: 20px;
                padding: 30px;
            }
            .alert-container .alert{
                justify-content: center;
                padding: 20px 20px;
            }
            .alert-container .alert-success{
                border-radius: 12px;
                border: 1px solid #117054;
            }
          
        </style>
        {% if messages %}
        {% for message in messages %}
            <script> 
            Swal.fire({
               type: 'success',
               icon: 'success',
               showConfirmButton: false,
               title:'{{message}}'
               });
            </script>
        {% endfor %}
    {% endif %}
{% endblock %}
   