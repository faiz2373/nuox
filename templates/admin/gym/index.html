{% extends "admin/layout/user_base.html" %}
{% load static %}
{% block body_block %}
{% load my_filters %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <main class="content-area">
        <div class="container-fluid p-0">
            <!-- top search bar -->
            <div class="top-seach-bar mb-0">
                <!-- top bar form  -->
                <form class="search-form mt-2">

                    <div class="add-product-filter user_table_product_filter">
                        <div class="row align-items-center">
                            <div class="col-xl-2 col-lg-2">
                                <h3 class="top-bar-heading">Gym</h3>
                            </div>
                            <div class="col-xl-10 col-lg-10">
                                <div class="row_2 align-items-top justify-content-end">
                                    <div class="top-search-wrapper">
                                        <div class="form-group">
                                            <input type="text" name="search" value="{{ request.GET.search }}" id="name"
                                                   class="form-control" placeholder="Search">
                                        </div>
                                        <div style="width: 103%;"><span id="error_msg"></span></div>

                                    </div>

                                    <div class="date-selector-wrapper">
                                        <div class="form-group">
                                          <input type="text" name="stDate" value="{{ request.GET.stDate }}" class="form-control" id="stDate" placeholder="From Date">
                                        </div>
                                    </div> 
                                    
                                    <div class="date-selector-wrapper">
                                        <div class="form-group">
                                          <input type="text" name="endDate" value="{{ request.GET.endDate }}" class="form-control" id="endDate" placeholder="To Date">
                                        </div>
                                    </div> 

                                    <div class="top-action-wrapper d-flex align-items-top ">
                                        <button class="btn btn-detail " id="sbmit">Filter</button>
                                        <a href="{% url 'appdashboard:gym' %}" class="reset">Reset</a>
                                        <a href="{% url 'appdashboard:gym_add'%}">
                                            <button type="button" class="btn btn-detail">Create</button>
                                        </a>
                                    </div>
                                </div>
                                
                            </div>                      
                        </div>
                    </div>
                </form>

                
            </div>
            <!-- top bar form  end-->
        </div>

        <!-- top search bar end-->

        <!-- right side content box  -->
        <div class="main-box pd-0">

            <div class="add-product-sec">
                <div class="product-area-list">
                </div>
                <div class="product-area-list list-head" >
                    <div class="product-box-heading gymIndexData bx-sd mb-1">
                        <div class="row">
                            <!-- <div class="col-xl-1 col-lg-1">

                            </div> -->
                            <div class="col-xl-1 col-lg-1">
                                <div class="product-content">
                                    SL
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2">
                                <div class="product-content">
                                    Name
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2">
                                <div class="product-content">
                                    Phone
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2">
                                <div class="product-content">
                                    Location
                                </div>
                            </div>
                            <div class="col-xl-1 col-lg-1">
                                <div class="product-content">
                                    Created Date
                                </div>
                            </div>
                            <div class="col-xl-4 col-lg-4 ">
                                <div class="product-content">
                                    Action
                                </div>
                            </div>
                        </div>
                    </div>
                    {% for rec in records %}
                        <!-- prodcut box  -->
                        <div class="product-box gymIndexData  user-level bx-sd mb-1">
                            <div class="row">
                                <!-- <div class="col-xl-1 col-lg-1">

                                </div> -->
                                <div class="col-xl-1 col-lg-1">
                                    <div class="product-content">
                                        <h3>{{ start_index|add:forloop.counter0 }}</h3>
                                    </div>
                                </div>
        
                                <div class="col-xl-2 col-lg-2">
                                    <div class="product-content">
                                        <a href="{% url 'appdashboard:gym_details' pk=rec.pk %}"><h3 id="hovertest">{% if rec.name %}{{ rec.name }}{% else %}{{ rec.name_ar }}{% endif %}</h3></a>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-2">
                                    <div class="product-content">
                                        <h3>{% if rec.mobile %} <span>+971</span>{{ rec.mobile }}{% else %}---{% endif %}</h3>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-2">
                                    <div class="product-content" style="font-weight: 400;">
                                        {% with rec.coordinates|cut:'SRID=4326;POINT ('|cut:')' as coords %}
                                        {% with coords|split_string:' ' as coordinates %}
                                        Longitude: {{ coordinates.0 }}
                                        </br>
                                        Latitude: {{ coordinates.1 }}
                                        {% endwith %}
                                        {% endwith %}
                                        
                                    </div>
                                </div>
                            <div class="col-xl-1 col-lg-1">
                                <div class="product-content">
                                    <h3>{% if rec.created_at %}{{ rec.created_at| to_default_timezone }}{% else %}---{% endif %}</h3>
                                </div>
                            </div>
                                <div class="col-xl-4 col-lg-4 user-activity ">
                                    <!-- <div class="pro-det flexDiv"> -->
                                        <a href="/sec-access/user?gym={{rec.id}}">
                                            <button class="btn btn-detail ">View Members</button>
                                         </a>
                                        <a href="{% url 'appdashboard:gym_edit' pk=rec.pk %}">
                                            <button class="btn btn-detail ">Edit</button>
                                        </a>
                                        <button type="button" onclick="statusChange('{{rec.id}}',{% if rec.is_active == 0 %}'enable'{% else %}'disable'{% endif %})" {% if rec.is_active == 0 %} class="btn btn-detail" {% else %} class="btn btn-detail disb_btn" {% endif %} id="statusBtn_{{rec.id}}" >
                                                {% if rec.is_active == 0 %} 
                                                    Enable
                                                {% else %}
                                                    Disable
                                                {% endif %}
                                            </button>

                                    <!-- </div> -->
                                </div>

                               
                            </div>
                        </div>
                    {% empty %}
                    <div class="col-xl-12 col-lg-3 text-center mt-3">
                        <h5>No Records</h5>
                    </div>
                    {% endfor %}

                    {% if records %}
                    <div class="row">
                        <div class="col-sm-6 mt-3 pagination-count">Showing <span>{{ start_index }}</span> to <span>{{ end_index }}</span> of <span>{{ count }}</span> entries</div>

                        <div class="col-sm-6 mt-3">
                            <nav aria-label="Page navigation ">
                                <ul class="pagination justify-content-end">
                                    {% for i in page_range %}
                                    <li id="pagination-count{{i}}"
                                        class="page-item"><a
                                            class="{% if i  == page %} activedata {% endif %} page-link" href="?page={{ i }}{{ params }}">{{i}}</a></li>
                                    {% endfor %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <!-- prodcut box  end-->
            </div>
        </div>
        </div>
        {% csrf_token %}
        <!-- right side content box  -->
        </div>
    </main>
{% endblock body_block %}

{% block page_script %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    flatpickr("#stDate", {
      allowInput: true,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });
    flatpickr("#endDate", {
      allowInput: true,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });
    
    $("#sbmit").click(function()
        {
            name = $('#name').val()
            stDate = $('#stDate').val()
            endDate = $('#endDate').val()
            date_flag = 0

            if(stDate != '' && endDate != ''){
                date_flag=1
            }
            else{
                if(stDate!='' && endDate ==''){
                    $('#error_msg').text('You cannot leave to date empty')
                    date_flag = 0
                    return false
                }
                else if(stDate =='' && endDate !=''){
                    $('#error_msg').text('You cannot leave from date empty')
                    date_flag = 0
                    return false
                }
                else  if(stDate =='' && endDate ==''){
                    date_flag = 0
                }
            }
           
            if (name == '' && date_flag == 0)
            {
                $('#error_msg').text('Choose any filtering option')
                return false;
            }
        })  

        function statusChange(id,msg)
            {
                Swal.fire({
                    title: 'Are you sure?',  
                    text: 'Do you want to '+msg+' this gym!',   
                    type: 'warning',
                    confirmButtonText: 'Yes',
                    confirmButtonColor: 'LightSeaGreen',
                    cancelButtonColor: 'Crimson',
                    cancelButtonText: 'No',
                    showCancelButton: true,
                    // reverseButtons: true
                })
                .then(function(e){
                    if (e.value === true) {
                    data = {}
                    data['userid'] = id
                    $.ajax({
                    type:'PUT',
                    url: '/sec-access/gym-enabledisable/',
                    data: data,
                    success: function(response){
                        Swal.fire({
                            type: 'success',
                            icon: 'success',
                            showConfirmButton: false,
                            title: response.msg,
                            timer: 2000
                        });

                        var btnid = '#statusBtn_'+id;
                        if(msg == 'enable'){
                            $(btnid).text('DISABLE');
                            $(btnid).addClass('disb_btn')
                            $(btnid).attr('onclick', 'statusChange('+id+',"disable")');
                        }
                        else{
                            $(btnid).text('ENABLE');
                            $(btnid).removeClass('disb_btn')
                            $(btnid).attr('onclick', 'statusChange('+id+',"enable")');
                        }
                    }
                })
                
            }
        })
        }

    </script>
    <style>
            .product-content{
                overflow: hidden;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            }
            .alert-container{
                position: absolute;
                top: 45%;
                left: 20%;
                right: auto;
                margin: auto;
                width: 75%;
                height: 20px;
                padding: 30px;
            }
            .alert-container .alert{
                justify-content: center;
                padding: 20px 20px;
            }
            .alert-container .alert-success{
                border-radius: 12px;
                border: 1px solid #117054;
            }
           
            #hovertest:hover{
                color: rgb(16, 16, 198);
            }
            #error_msg{
                color:red;
            }
            .flexDiv{
                display: flex;
                flex-wrap: nowrap;
                justify-content: space-around;
            }
            .width12{
                width:12%!important;
            }
            .width15{
                width:15%!important;
            }
            .width20{
                width:20%!important;
            }
    </style>
    {% if messages %}
    {% for message in messages %}
        {% if message.tags == "success" %}
             <script> 
             Swal.fire({
                 type: 'success',
                 icon: {% if message.tags == 'error' %} 'error' {% else %} '{{message.tags}}' {% endif %},
                 showConfirmButton: false,
                 title:'{{message}}'
                 });
                 setTimeout(function(){
                window.location.reload(1);
                }, 1000);
             </script>
         {% endif %}
         {% if message.tags == "error" %}
             <script> 
             Swal.fire({
                 type: 'error',
                 icon: 'info',
                 showConfirmButton: false,
                 title:'{{message}}'
                 });
                 setTimeout(function(){
                window.location.reload(1);
                }, 1000);
             </script>
         {% endif %}
    {% endfor %}
    {% endif %}
{% endblock %}
   